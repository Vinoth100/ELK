input {
  file {
    path => "/data/my.log"
    start_position => beginning 
  }
}

filter {

grok{
match => {"message" =>"(?<timeinMillis>[0-9]{10}) - %{IP:clientIP} - (?<loglevel>[a-zA-Z]*) - \[(?<keyvalue>.*)] - (?<msg>.*)" } 
}

kv{
source => "keyvalue"
field_split => ","
}

 
date {
 locale => "en-US"
 match => [ "timeinMillis", "UNIX" ]
 timezone => "Europe/Vienna"
 target => "logdatetimestamp"
}

 geoip {
    source => "clientIP"
    target => "geoip"
    database => "/etc/logstash/GeoLiteCity.dat"
    add_field => [ "[geoip][coordinates]", "%{[geoip][longitude]}" ]
    add_field => [ "[geoip][coordinates]", "%{[geoip][latitude]}"  ]
   }
    mutate {
      convert => [ "[geoip][coordinates]", "float"]
    }

}

output {
  elasticsearch { }

  stdout {codec => rubydebug } 

}
